<?xml version="1.0" encoding="utf-8" ?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <PropertyGroup>
    <_ReportPortal_XUnit_Runtime_Path>$(MSBuildThisFileDirectory)..\..\lib\net472\ReportPortal.XUnit.reporters.dll</_ReportPortal_XUnit_Runtime_Path>
    <_ReportPortal_XUnit_Runtime_Pdb_Path>$(MSBuildThisFileDirectory)..\..\lib\net472\ReportPortal.XUnit.reporters.pdb</_ReportPortal_XUnit_Runtime_Pdb_Path>
    <_ReportPortal_XUnit_Content_Path>$(MSBuildThisFileDirectory)..\_content</_ReportPortal_XUnit_Content_Path>
  </PropertyGroup>

  <!-- This target runs before compilation to include the auto-registration file -->
  <Target Name="_ReportPortalIncludeAutoRegistration" BeforeTargets="BeforeCompile">
    <Message Text="ReportPortal: Including auto-registration file for net462 target" Importance="high" />
    <Message Text="ReportPortal: Content path is $(_ReportPortal_XUnit_Content_Path)" Importance="high" />
    
    <!-- Include the auto-registration file for C# projects -->
    <ItemGroup Condition=" '$(Language)' == 'C#' ">
      <Compile Include="$(_ReportPortal_XUnit_Content_Path)\ReportPortalReporterAutoRegistration.cs" />
    </ItemGroup>
    
    <Message Text="ReportPortal: Auto-registration file included successfully" Importance="high" Condition=" '$(Language)' == 'C#' " />
    <Message Text="ReportPortal: Skipping auto-registration (non-C# project detected)" Importance="high" Condition=" '$(Language)' != 'C#' " />
  </Target>

  <!-- Add a diagnostic target to verify the build process -->
  <Target Name="_ReportPortalDiagnostics" AfterTargets="Build">
    <Message Text="ReportPortal: Build completed, diagnostics information:" Importance="high" />
    <Message Text="ReportPortal: MSBuildProjectDirectory = $(MSBuildProjectDirectory)" Importance="high" />
    <Message Text="ReportPortal: IntermediateOutputPath = $(IntermediateOutputPath)" Importance="high" />
    <Message Text="ReportPortal: Language = $(Language)" Importance="high" />
    <Message Text="ReportPortal: TargetFramework = $(TargetFramework)" Importance="high" />
  </Target>

</Project>
